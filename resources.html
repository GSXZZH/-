<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>王朴中学社区 - 资源</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#dc2626',
                        secondary: '#f87171',
                        dark: '#b91c1c',
                        light: '#fef2f2',
                        gray: '#f3f4f6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-smooth {
                transition: all 0.3s ease;
            }
            .shadow-custom {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
        }
    </style>
</head>
<body class="bg-gray min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <img src="wpzxxh.png" alt="王朴中学校徽" class="h-12">
                <h1 class="text-xl font-bold text-primary">王朴中学社区</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="home.html" class="nav-link text-gray-700 hover:text-primary transition-smooth">首页</a>
                <a href="chat.html" class="nav-link text-gray-700 hover:text-primary transition-smooth">聊天</a>
                <a href="resources.html" class="nav-link text-primary font-medium">资源</a>
                <a href="vote.html" class="nav-link text-gray-700 hover:text-primary transition-smooth">投票系统</a>
            </nav>
            <div class="flex items-center space-x-4">
                <div class="relative" id="user-menu">
                    <button type="button" id="user-menu-button" class="flex items-center space-x-2 focus:outline-none">
                        <img id="user-avatar" src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f13bb2b36f7f4f24b0f53001b7293f54~tplv-a9rns2rl98-image.image?rcl=202511231254528EA2913FE4D8DECDB6BA&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766465737&x-signature=hO5pm4egQgR7Rc2mqJpKApiovws%3D" alt="用户头像" class="h-8 w-8 rounded-full object-cover">
                        <span id="user-name" class="text-sm font-medium text-gray-700">用户名</span>
                        <i class="fa fa-chevron-down text-xs text-gray-500"></i>
                    </button>
                    <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray" id="profile-link">个人资料</a>
                        <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray">设置</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray" id="logout-link">退出登录</a>
                    </div>
                </div>
                <button type="button" id="mobile-menu-button" class="md:hidden focus:outline-none">
                    <i class="fa fa-bars text-gray-700 text-xl"></i>
                </button>
            </div>
        </div>
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="md:hidden bg-white shadow-sm hidden">
            <div class="container mx-auto px-4 py-2">
                <a href="home.html" class="mobile-nav-link block py-2 text-gray-700 hover:text-primary transition-smooth">首页</a>
                <a href="chat.html" class="mobile-nav-link block py-2 text-gray-700 hover:text-primary transition-smooth">聊天</a>
                <a href="resources.html" class="mobile-nav-link block py-2 text-primary font-medium">资源</a>
                <a href="vote.html" class="mobile-nav-link block py-2 text-gray-700 hover:text-primary transition-smooth">投票系统</a>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- 资源页面 -->
        <section id="resources-section">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 资源上传 -->
                <div class="bg-white rounded-lg shadow-custom p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">上传资源</h3>
                    <div class="space-y-4">
                        <!-- 拖拽上传区域 -->
                        <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center hover:border-primary transition-all duration-300">
                            <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-500 mb-2">拖拽文件到此处或点击上传</p>
                            <p class="text-xs text-gray-400 mb-3">支持的格式: 文档(.pdf,.doc,.docx), 图片(.jpg,.jpeg,.png), 视频(.mp4), 压缩包(.zip,.rar) 单个文件最大50MB</p>
                            <input type="file" id="file-upload" class="hidden" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.mp4,.zip,.rar">
                            <button id="upload-button" class="bg-primary text-white py-2 px-4 rounded-md hover:bg-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-200 hover:shadow-md">选择文件</button>
                        </div>
                        <!-- 上传预览 -->
                        <div id="upload-preview" class="hidden">
                            <h4 class="font-medium text-gray-700 mb-2">上传预览</h4>
                            <div id="file-list" class="space-y-2 max-h-60 overflow-y-auto p-2 border border-gray-200 rounded-md">
                                <!-- 文件列表将在这里动态生成 -->
                            </div>
                            <div class="mt-3 flex justify-between items-center">
                                <button id="cancel-upload" class="text-gray-500 hover:text-gray-700 text-sm">取消选择</button>
                                <button id="submit-upload" class="bg-primary text-white py-2 px-6 rounded-md hover:bg-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-200 hover:shadow-md">确认上传</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 资源列表 -->
                <div class="md:col-span-2 bg-white rounded-lg shadow-custom p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">资源列表</h3>
                        <div class="relative">
                            <input type="text" id="resource-search" class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="搜索资源...">
                            <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <div class="flex items-center cursor-pointer" id="sort-name">
                                            文件名 <i class="fa fa-sort ml-1"></i>
                                        </div>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">类型</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">大小</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">上传者</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <div class="flex items-center cursor-pointer" id="sort-time">
                                            上传时间 <i class="fa fa-sort ml-1"></i>
                                        </div>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="resources-table-body" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">暂无资源</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-4">
        <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
            <p>© 2025 王朴中学社区. 保留所有权利.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="notification.js"></script>
    <script>
        // 数据存储模块
        const DataStore = {
            // 用户相关方法
            getUsers() {
                return JSON.parse(localStorage.getItem('wangpu_users') || '[]');
            },
            
            getUserById(id) {
                return this.getUsers().find(user => user.id === id);
            },
            
            // 当前用户相关方法
            getCurrentUser() {
                const userId = localStorage.getItem('wangpu_current_user');
                if (userId) {
                    return this.getUserById(userId);
                }
                return null;
            },
            
            clearCurrentUser() {
                localStorage.setItem('wangpu_current_user', null);
            },
            
            // 文件相关方法
            getFiles() {
                return JSON.parse(localStorage.getItem('wangpu_files') || '[]');
            },
            
            addFile(file) {
                const files = this.getFiles();
                file.id = Date.now().toString();
                file.timestamp = new Date().toISOString();
                file.status = 'completed';
                files.push(file);
                localStorage.setItem('wangpu_files', JSON.stringify(files));
                return file;
            },
            
            deleteFile(id) {
                const files = this.getFiles();
                const updatedFiles = files.filter(file => file.id !== id);
                localStorage.setItem('wangpu_files', JSON.stringify(updatedFiles));
                return true;
            }
        };

        // 工具函数
        const Utils = {
            // 格式化日期时间
            formatDateTime(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },
            
            // 文件大小格式化
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
                else return (bytes / 1048576).toFixed(2) + ' MB';
            },
            
            // 获取文件图标
            getFileIcon(fileType) {
                if (fileType.startsWith('image/')) return 'fa-file-image-o';
                if (fileType.startsWith('audio/')) return 'fa-file-audio-o';
                if (fileType.startsWith('video/')) return 'fa-file-video-o';
                if (fileType.includes('pdf')) return 'fa-file-pdf-o';
                if (fileType.includes('word') || fileType.includes('doc')) return 'fa-file-word-o';
                if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'fa-file-excel-o';
                if (fileType.includes('powerpoint') || fileType.includes('presentation')) return 'fa-file-powerpoint-o';
                if (fileType.includes('text') || fileType.includes('plain')) return 'fa-file-text-o';
                return 'fa-file-o';
            }
        };

        // 应用主类
        class WangpuCommunityApp {
            constructor() {
                this.selectedFiles = [];
                this.sortConfig = {
                    field: 'timestamp',
                    direction: 'desc'
                };
                this.init();
            }
            
            // 初始化应用
            async init() {
                // 初始化数据存储
                DataStore.init && DataStore.init();
                
                // 如果有持久化存储，先从IndexedDB加载数据到localStorage
                if (window.persistentStorage) {
                    try {
                        await persistentStorage.initDB();
                        await persistentStorage.loadDBToLocalStorage();
                        console.log('已从持久化存储加载数据');
                    } catch (error) {
                        console.warn('从持久化存储加载数据失败:', error);
                    }
                }
                
                // 检查用户是否已登录
                await this.checkLoginStatus();
                
                // 更新用户信息
                this.updateUserInfo();
                
                // 加载资源列表
                this.loadResourcesList();
                
                // 绑定事件
                this.bindEvents();
            }
            
            // 检查登录状态
            async checkLoginStatus() {
                const currentUser = DataStore.getCurrentUser();
                if (!currentUser) {
                    // 用户未登录，跳转到登录页面
                    window.location.href = 'index.html';
                }
            }
            
            // 更新用户信息
            updateUserInfo() {
                const currentUser = DataStore.getCurrentUser();
                if (currentUser) {
                    // 优先使用avatarData（base64数据）进行预览，如果没有则使用avatar路径
                    const avatarSrc = currentUser.avatarData || currentUser.avatar;
                    document.getElementById('user-avatar').src = avatarSrc;
                    document.getElementById('user-name').textContent = currentUser.name;
                }
            }
            
            // 加载资源列表
            loadResourcesList() {
                const files = DataStore.getFiles();
                const tableBody = document.getElementById('resources-table-body');
                const searchInput = document.getElementById('resource-search');
                const searchTerm = searchInput?.value.toLowerCase() || '';
                
                // 过滤和排序
                let filteredFiles = files;
                if (searchTerm) {
                    filteredFiles = files.filter(file => 
                        file.name.toLowerCase().includes(searchTerm)
                    );
                }
                
                // 排序
                filteredFiles.sort((a, b) => {
                    if (this.sortConfig.field === 'name') {
                        if (this.sortConfig.direction === 'asc') {
                            return a.name.localeCompare(b.name);
                        } else {
                            return b.name.localeCompare(a.name);
                        }
                    } else {
                        // 默认按时间排序
                        if (this.sortConfig.direction === 'asc') {
                            return new Date(a.timestamp) - new Date(b.timestamp);
                        } else {
                            return new Date(b.timestamp) - new Date(a.timestamp);
                        }
                    }
                });
                
                if (filteredFiles.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">暂无资源</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                filteredFiles.forEach(file => {
                    const uploader = DataStore.getUserById(file.uploader);
                    const fileIcon = Utils.getFileIcon(file.type);
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-all duration-200 opacity-0 transform translate-y-2';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fa ${fileIcon} text-primary mr-2"></i>
                                <span class="font-medium text-gray-800 truncate max-w-xs">${file.name}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${file.type}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${Utils.formatFileSize(file.size)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${uploader ? uploader.name : '未知用户'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${Utils.formatDateTime(file.timestamp)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-primary hover:text-dark download-file mr-3" data-file-id="${file.id}">下载</a>
                            <a href="#" class="text-red-500 hover:text-red-700 delete-file" data-file-id="${file.id}">删除</a>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                    
                    // 添加动画效果
                    setTimeout(() => {
                        row.classList.remove('opacity-0', 'translate-y-2');
                    }, 50);
                });
                
                // 添加下载事件
                document.querySelectorAll('.download-file').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const fileId = link.dataset.fileId;
                        this.downloadFile(fileId);
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-file').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const fileId = link.dataset.fileId;
                        this.deleteFile(fileId);
                    });
                });
            }
            
            // 删除文件
            deleteFile(fileId) {
                if (confirm('确定要删除这个文件吗？')) {
                    if (DataStore.deleteFile(fileId)) {
                        // 重新加载资源列表
                        this.loadResourcesList();
                        window.notificationSystem.success('文件删除成功');
                    } else {
                        window.notificationSystem.error('文件删除失败');
                    }
                }
            }
            
            // 下载文件
            downloadFile(fileId) {
                const file = DataStore.getFiles().find(f => f.id === fileId);
                if (!file) {
                    window.notificationSystem.error('文件不存在');
                    return;
                }
                
                // 显示下载开始通知
                window.notificationSystem.info(`正在下载 ${file.name}...`);
                
                // 创建下载链接
                const link = document.createElement('a');
                link.href = file.url;
                link.download = file.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            

            
            // 验证文件类型和大小
            validateFile(file) {
                // 允许的文件类型
                const allowedTypes = [
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.ms-powerpoint',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                    'image/jpeg',
                    'image/png',
                    'image/gif',
                    'text/plain',
                    'application/zip',
                    'application/x-rar-compressed'
                ];
                
                // 允许的文件大小 (50MB)
                const maxSize = 50 * 1024 * 1024;
                
                // 验证文件类型
                if (!allowedTypes.includes(file.type)) {
                    window.notificationSystem.error('不支持的文件类型');
                    return false;
                }
                
                // 验证文件大小
                if (file.size > maxSize) {
                    window.notificationSystem.error('文件大小超过限制 (最大50MB)');
                    return false;
                }
                
                return true;
            }
            
            // 处理文件上传
            handleFileUpload(files) {
                if (!files || files.length === 0) return;
                
                // 过滤有效文件
                this.selectedFiles = Array.from(files).filter(file => this.validateFile(file));
                
                if (this.selectedFiles.length === 0) {
                    window.notificationSystem.error('没有符合要求的文件');
                    return;
                }
                
                // 显示上传预览
                const uploadPreview = document.getElementById('upload-preview');
                const fileList = document.getElementById('file-list');
                
                uploadPreview.classList.remove('hidden');
                fileList.innerHTML = '';
                
                this.selectedFiles.forEach(file => {
                    const fileIcon = Utils.getFileIcon(file.type);
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center justify-between p-2 bg-white rounded-md shadow-sm';
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fa ${fileIcon} text-primary mr-2"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-800 truncate max-w-xs">${file.name}</p>
                                <p class="text-xs text-gray-500">${Utils.formatFileSize(file.size)}</p>
                            </div>
                        </div>
                        <button class="text-gray-500 hover:text-primary remove-file" data-index="${this.selectedFiles.indexOf(file)}">
                            <i class="fa fa-times"></i>
                        </button>
                    `;
                    fileList.appendChild(fileItem);
                });
                
                // 添加移除文件事件
                document.querySelectorAll('.remove-file').forEach(button => {
                    button.addEventListener('click', () => {
                        const index = parseInt(button.dataset.index);
                        this.selectedFiles.splice(index, 1);
                        this.handleFileUpload(this.selectedFiles);
                    });
                });
            }
            
            // 提交文件上传
            submitFileUpload() {
                if (this.selectedFiles.length === 0) return;
                
                const currentUser = DataStore.getCurrentUser();
                const uploadPreview = document.getElementById('upload-preview');
                const fileList = document.getElementById('file-list');
                
                // 添加上传进度显示
                const progressContainer = document.createElement('div');
                progressContainer.className = 'mt-3';
                progressContainer.innerHTML = `
                    <div class="text-sm text-gray-600 mb-1">正在上传...</div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="upload-progress" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                `;
                uploadPreview.appendChild(progressContainer);
                
                // 禁用上传按钮
                document.getElementById('submit-upload').disabled = true;
                document.getElementById('cancel-upload').disabled = true;
                
                let completedUploads = 0;
                const totalUploads = this.selectedFiles.length;
                
                this.selectedFiles.forEach(file => {
                    // 创建文件读取器
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        // 模拟文件上传进度
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += Math.random() * 20;
                            if (progress >= 100) {
                                progress = 100;
                                clearInterval(interval);
                                
                                // 上传完成后处理
                                setTimeout(() => {
                                    completedUploads++;
                                    const overallProgress = (completedUploads / totalUploads) * 100;
                                    document.getElementById('upload-progress').style.width = `${overallProgress}%`;
                                    
                                    // 创建文件数据
                                    const fileData = {
                                        name: file.name,
                                        type: file.type,
                                        size: file.size,
                                        uploader: currentUser.id,
                                        url: e.target.result // 在实际应用中，这里应该是服务器返回的文件URL
                                    };
                                    
                                    // 保存文件信息
                                    DataStore.addFile(fileData);
                                    
                                    // 所有文件上传完成
                                    if (completedUploads === totalUploads) {
                                        // 重置选择的文件
                                        this.selectedFiles = [];
                                        
                                        // 隐藏上传预览
                                        document.getElementById('upload-preview').classList.add('hidden');
                                        
                                        // 重新加载资源列表
                                        this.loadResourcesList();
                                        
                                        // 显示通知
                                        window.notificationSystem.success('文件上传成功');
                                    }
                                }, 500);
                            }
                            const currentFileProgress = (completedUploads / totalUploads * 100) + (progress / totalUploads);
                            document.getElementById('upload-progress').style.width = `${currentFileProgress}%`;
                        }, 300);
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
            
            // 退出登录
            logout() {
                // 清除当前用户
                DataStore.clearCurrentUser();
                
                // 跳转到登录页面
                window.location.href = 'index.html';
            }
            
            // 绑定事件
            bindEvents() {
                // 用户菜单
                document.getElementById('user-menu-button').addEventListener('click', () => {
                    document.getElementById('user-dropdown').classList.toggle('hidden');
                });
                
                // 点击页面其他地方关闭用户菜单
                document.addEventListener('click', (e) => {
                    const userMenu = document.getElementById('user-menu');
                    if (!userMenu.contains(e.target)) {
                        document.getElementById('user-dropdown').classList.add('hidden');
                    }
                });
                
                // 移动端菜单
                document.getElementById('mobile-menu-button').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });
                
                // 文件上传按钮
                document.getElementById('upload-button').addEventListener('click', () => {
                    document.getElementById('file-upload').click();
                });
                
                // 文件选择变化
                document.getElementById('file-upload').addEventListener('change', (e) => {
                    this.handleFileUpload(e.target.files);
                });
                
                // 提交文件上传按钮
                document.getElementById('submit-upload').addEventListener('click', () => {
                    this.submitFileUpload();
                });
                
                // 个人资料链接
                document.getElementById('profile-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    alert('个人资料功能正在开发中');
                });
                
                // 退出登录链接
                document.getElementById('logout-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });
                
                // 排序事件
                document.getElementById('sort-name').addEventListener('click', () => {
                    if (this.sortConfig.field === 'name') {
                        // 切换排序方向
                        this.sortConfig.direction = this.sortConfig.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        // 设置新的排序字段和方向
                        this.sortConfig.field = 'name';
                        this.sortConfig.direction = 'asc';
                    }
                    this.loadResourcesList();
                });
                
                document.getElementById('sort-time').addEventListener('click', () => {
                    if (this.sortConfig.field === 'timestamp') {
                        // 切换排序方向
                        this.sortConfig.direction = this.sortConfig.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        // 设置新的排序字段和方向
                        this.sortConfig.field = 'timestamp';
                        this.sortConfig.direction = 'desc';
                    }
                    this.loadResourcesList();
                });
                
                // 搜索事件
                const searchInput = document.getElementById('resource-search');
                if (searchInput) {
                    let searchTimeout;
                    searchInput.addEventListener('input', () => {
                        // 防抖搜索
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.loadResourcesList();
                        }, 300);
                    });
                }
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            const app = new WangpuCommunityApp();
        });
    </script>
</body>
</html>
